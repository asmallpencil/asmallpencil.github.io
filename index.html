<!DOCTYPE html>
<html>
<head>
    <title>铅笔站开发中</title>
    <style>
        /* 基础样式 */
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            touch-action: none;
            font-family: Arial;
        }
        #gameTitle {
            color: white;
            text-align: center;
            padding: 20px;
            font-size: 24px;
        }
        canvas {
            border: 1px solid #333;
        }
        /* 游戏UI */
        #ui {
            position: fixed;
            top: 100px;
            left: 20px;
            color: white;
        }
        .skillBtn {
            padding: 10px;
            margin: 5px;
            background: #444;
            border-radius: 5px;
            cursor: pointer;
            display: inline-block;
            transition: all 0.3s;
        }
        .active {
            background: #666;
            box-shadow: 0 0 10px #ffd700;
        }
        /* 游戏结束提示 */
        #gameOver {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: red;
            font-size: 48px;
            display: none;
        }
        /* 敌人血条 */
        .hp-bar {
            position: absolute;
            width: 30px;
            height: 3px;
            background: red;
            top: -5px;
        }
    </style>
</head>
<body>
    <h1 id="gameTitle">铅笔站开发中</h1>
    <canvas id="gameCanvas"></canvas>
    <div id="ui">
        <div id="hpDisplay">生命值：100%</div>
        <div id="goldDisplay">金币：0</div>
        <div>
            <div id="explosiveBtn" class="skillBtn">高爆弹 [200]</div>
            <div id="shotgunBtn" class="skillBtn">散弹 [100]</div>
            <div id="iceBtn" class="skillBtn">寒冰弹 [50]</div>
        </div>
    </div>
    <div id="gameOver">游戏结束！</div>

    <script>
        // 游戏核心对象初始化
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let gameActive = true;

        /* 游戏参数配置 */
        const CONFIG = {
            PLAYER: {
                BULLET_SIZE: 6,      // 子弹大小调整为原来的2倍（原为3）
                BASE_FIRE_RATE: 10   // 基础子弹速度
            },
            ENEMY: {
                RED: { hp: 1, speed: 2, value: 10, spawnChance: 0.02, color: 'red' },
                YELLOW: { hp: 5, speed: 1, value: 50, spawnChance: 0.01, color: 'yellow' }
            },
            SKILLS: {
                EXPLOSIVE: { cost: 200, interval: 1000 },  // 高爆弹参数
                SHOTGUN: { cost: 100, interval: 500 },     // 散弹参数
                ICE: { cost: 50, cooldown: 2000 }          // 寒冰弹参数
            }
        };

        // 游戏状态
        let gold = 0;
        let playerHP = 100;
        let activeEffects = [];
        let skillStates = {
            explosive: { active: false, lastFire: 0 },
            shotgun: { active: false, lastFire: 0 }
        };

        /* 初始化画布 */
        function initCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight - 80;
            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight - 80;
            });
        }
        initCanvas();

        // 玩家对象
        const player = {
            x: canvas.width/2,
            y: canvas.height - 30,
            width: 40,
            height: 20,
            angle: 0
        };

        // 游戏对象池
        let enemies = [];
        let bullets = [];

        /* 输入控制系统 */
        let input = {
            touchX: 0,
            isTouching: false,
            mouseX: canvas.width/2
        };

        // 事件监听
        canvas.addEventListener('mousemove', e => input.mouseX = e.clientX);
        canvas.addEventListener('touchstart', e => {
            input.isTouching = true;
            input.touchX = e.touches[0].clientX;
        });
        canvas.addEventListener('touchmove', e => input.touchX = e.touches[0].clientX);
        canvas.addEventListener('touchend', () => input.isTouching = false);

        /* 技能系统 */
        document.querySelectorAll('.skillBtn').forEach(btn => {
            btn.addEventListener('click', function() {
                const type = this.id.replace('Btn', '');
                toggleSkill(type);
            });
        });

        // 切换技能状态
        function toggleSkill(type) {
            if (type === 'explosive' || type === 'shotgun') {
                skillStates[type].active = !skillStates[type].active;
                document.getElementById(`${type}Btn`).classList.toggle('active', skillStates[type].active);
            }
        }

        /* 武器系统 */
        // 自动武器处理
        function handleAutoWeapons() {
            const now = Date.now();
            
            // 高爆弹系统
            if (skillStates.explosive.active) {
                if (now - skillStates.explosive.lastFire > CONFIG.SKILLS.EXPLOSIVE.interval) {
                    if (gold >= CONFIG.SKILLS.EXPLOSIVE.cost) {
                        fireExplosive();
                        gold -= CONFIG.SKILLS.EXPLOSIVE.cost;
                        skillStates.explosive.lastFire = now;
                    }
                }
            }

            // 散弹系统
            if (skillStates.shotgun.active) {
                if (now - skillStates.shotgun.lastFire > CONFIG.SKILLS.SHOTGUN.interval) {
                    if (gold >= CONFIG.SKILLS.SHOTGUN.cost) {
                        fireShotgun();
                        gold -= CONFIG.SKILLS.SHOTGUN.cost;
                        skillStates.shotgun.lastFire = now;
                    }
                }
            }
        }

        // 发射高爆弹
        function fireExplosive() {
            bullets.push({
                x: player.x,
                y: player.y,
                speed: 15,
                angle: player.angle,
                isExplosive: true,
                color: 'orange',
                size: CONFIG.PLAYER.BULLET_SIZE
            });
        }

        // 发射散弹（修改为100发30度散射）
        function fireShotgun() {
            const spreadRange = Math.PI/6; // 30度换算为弧度
            const roundCount = 100;        // 弹片数量
            
            for(let i = 0; i < roundCount; i++) {
                const angle = player.angle - spreadRange/2 + (spreadRange * Math.random());
                bullets.push({
                    x: player.x,
                    y: player.y,
                    speed: 15,
                    angle: angle,
                    color: 'white',
                    size: CONFIG.PLAYER.BULLET_SIZE
                });
            }
        }

        /* 游戏对象管理系统 */
        // 生成敌人
        function spawnEnemy(type) {
            enemies.push({
                ...CONFIG.ENEMY[type.toUpperCase()],
                type: type,
                x: Math.random() * (canvas.width - 30),
                y: 0,
                width: 30,
                height: 30,
                currentHP: CONFIG.ENEMY[type.toUpperCase()].hp
            });
        }

        /* 碰撞检测系统 */
        function checkCollision(bullet, enemy) {
            return bullet.x > enemy.x &&
                   bullet.x < enemy.x + enemy.width &&
                   bullet.y > enemy.y &&
                   bullet.y < enemy.y + enemy.height;
        }

        /* 游戏主循环 */
        function gameLoop() {
            if (!gameActive || playerHP <= 0) {
                document.getElementById('gameOver').style.display = 'block';
                return;
            }

            // 清空画布
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 更新玩家角度
            const aimPosition = input.isTouching ? input.touchX : input.mouseX;
            const dx = aimPosition - player.x;
            player.angle = Math.atan2(-20, dx);

            // 自动发射基础子弹
            bullets.push({
                x: player.x,
                y: player.y,
                speed: CONFIG.PLAYER.BASE_FIRE_RATE,
                angle: player.angle,
                color: 'yellow',
                size: CONFIG.PLAYER.BULLET_SIZE
            });

            // 处理自动武器
            handleAutoWeapons();

            // 生成敌人
            Object.keys(CONFIG.ENEMY).forEach(type => {
                const cfg = CONFIG.ENEMY[type];
                if (Math.random() < cfg.spawnChance) {
                    spawnEnemy(type.toLowerCase());
                }
            });

            // 更新所有对象状态
            updateObjects();
            
            // 绘制游戏元素
            drawGameObjects();

            // 更新UI
            updateUI();

            requestAnimationFrame(gameLoop);
        }

        // 更新所有游戏对象
        function updateObjects() {
            // 更新子弹状态
            bullets.forEach((bullet, bIndex) => {
                bullet.x += bullet.speed * Math.cos(bullet.angle);
                bullet.y += bullet.speed * Math.sin(bullet.angle);

                // 边界检测
                if (bullet.y < 0 || bullet.x < 0 || bullet.x > canvas.width) {
                    bullets.splice(bIndex, 1);
                    return;
                }

                // 碰撞检测
                enemies.forEach((enemy, eIndex) => {
                    if (checkCollision(bullet, enemy)) {
                        const dmg = bullet.isExplosive ? 3 : 1;
                        enemy.currentHP -= dmg;
                        bullets.splice(bIndex, 1);

                        if (enemy.currentHP <= 0) {
                            gold += enemy.value;
                            playerHP = Math.min(100, playerHP + 0.5);
                            enemies.splice(eIndex, 1);
                        }
                    }
                });
            });

            // 更新敌人状态
            enemies.forEach((enemy, index) => {
                enemy.y += enemy.speed;
                if (enemy.y > canvas.height) {
                    playerHP -= 5;
                    enemies.splice(index, 1);
                }
            });
        }

        // 绘制所有游戏对象
        function drawGameObjects() {
            // 绘制玩家
            ctx.fillStyle = '#666';
            ctx.fillRect(
                player.x - player.width/2,
                player.y,
                player.width,
                player.height
            );

            // 绘制瞄准线
            ctx.beginPath();
            ctx.moveTo(player.x, player.y);
            ctx.lineTo(
                player.x + Math.cos(player.angle) * 1000,
                player.y + Math.sin(player.angle) * 1000
            );
            ctx.strokeStyle = 'rgba(255,255,255,0.5)';
            ctx.lineWidth = 3;
            ctx.stroke();

            // 绘制子弹（调整为双倍大小）
            bullets.forEach(bullet => {
                ctx.fillStyle = bullet.color;
                ctx.beginPath();
                ctx.arc(bullet.x, bullet.y, bullet.size, 20, Math.PI*20);
                ctx.fill();
            });

            // 绘制敌人
            enemies.forEach(enemy => {
                ctx.fillStyle = enemy.color;
                ctx.fillRect(enemy.x, enemy.y, 30, 30);
                
                // 血条系统
                ctx.fillStyle = 'red';
                ctx.fillRect(enemy.x, enemy.y - 5, 30, 3);
                ctx.fillStyle = 'lime';
                ctx.fillRect(
                    enemy.x,
                    enemy.y - 5,
                    30 * (enemy.currentHP / enemy.hp),
                    3
                );
            });
        }

        // 更新UI状态
        function updateUI() {
            document.getElementById('hpDisplay').textContent = 
                `生命值：${Math.min(100, playerHP.toFixed(1))}%`;
            document.getElementById('goldDisplay').textContent = `金币：${gold}`;
        }

        // 启动游戏
        gameLoop();
    </script>
</body>
</html>
